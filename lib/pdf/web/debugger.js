var opMap,FontInspector=(()=>{var fonts,createObjectURL,active=!1,fontAttribute="data-font-name";function resetSelection(){var div;for(div of document.querySelectorAll(`span[${fontAttribute}]`))div.className="debuggerHideText"}function selectFont(fontName,show){var div;for(div of document.querySelectorAll(`span[${fontAttribute}=${fontName}]`))div.className=show?"debuggerShowText":"debuggerHideText"}function textLayerClick(e){if(e.target.dataset.fontName&&"SPAN"===e.target.tagName.toUpperCase())for(var fontName=e.target.dataset.fontName,selects=document.getElementsByTagName("input"),i=0;i<selects.length;++i){var select=selects[i];select.dataset.fontName===fontName&&(select.checked=!select.checked,selectFont(fontName,select.checked),select.scrollIntoView())}}return{id:"FontInspector",name:"Font Inspector",panel:null,manager:null,init:function(pdfjsLib){var panel=this.panel,tmp=(panel.setAttribute("style","padding: 5px;"),document.createElement("button"));tmp.addEventListener("click",resetSelection),tmp.textContent="Refresh",panel.appendChild(tmp),fonts=document.createElement("div"),panel.appendChild(fonts),createObjectURL=pdfjsLib.createObjectURL},cleanup:function(){fonts.textContent=""},enabled:!1,get active(){return active},set active(value){if(active=value)document.body.addEventListener("click",textLayerClick,!0),resetSelection();else{var div;document.body.removeEventListener("click",textLayerClick,!0);for(div of document.querySelectorAll(`span[${fontAttribute}]`))div.className=""}},fontAdded:function(fontObj,url){var moreInfo=((obj,list)=>{for(var moreInfo=document.createElement("table"),i=0;i<list.length;i++){var tr=document.createElement("tr"),td1=document.createElement("td"),td1=(td1.textContent=list[i],tr.appendChild(td1),document.createElement("td"));td1.textContent=obj[list[i]].toString(),tr.appendChild(td1),moreInfo.appendChild(tr)}return moreInfo})(fontObj,["name","type"]),fontName=fontObj.loadedName,font=document.createElement("div"),name=document.createElement("span"),download=(name.textContent=fontName,document.createElement("a")),url=(url?(url=/url\(['"]?([^\)"']+)/.exec(url),download.href=url[1]):fontObj.data&&(download.href=createObjectURL(fontObj.data,fontObj.mimeType)),download.textContent="Download",document.createElement("a")),select=(url.href="",url.textContent="Log",url.addEventListener("click",function(event){event.preventDefault(),console.log(fontObj)}),document.createElement("input"));select.setAttribute("type","checkbox"),select.dataset.fontName=fontName,select.addEventListener("click",((select,fontName)=>function(){selectFont(fontName,select.checked)})(select,fontName)),font.appendChild(select),font.appendChild(name),font.appendChild(document.createTextNode(" ")),font.appendChild(download),font.appendChild(document.createTextNode(" ")),font.appendChild(url),font.appendChild(moreInfo),fonts.appendChild(font),setTimeout(()=>{this.active&&resetSelection()},2e3)}}})(),StepperManager=(()=>{var steppers=[],stepperDiv=null,stepperControls=null,stepperChooser=null,breakPoints=Object.create(null);return{id:"Stepper",name:"Stepper",panel:null,manager:null,init:function(pdfjsLib){var key,self=this;for(key in this.panel.setAttribute("style","padding: 5px;"),stepperControls=document.createElement("div"),(stepperChooser=document.createElement("select")).addEventListener("change",function(event){self.selectStepper(this.value)}),stepperControls.appendChild(stepperChooser),stepperDiv=document.createElement("div"),this.panel.appendChild(stepperControls),this.panel.appendChild(stepperDiv),sessionStorage.getItem("pdfjsBreakPoints")&&(breakPoints=JSON.parse(sessionStorage.getItem("pdfjsBreakPoints"))),opMap=Object.create(null),pdfjsLib.OPS)opMap[pdfjsLib.OPS[key]]=key},cleanup:function(){stepperChooser.textContent="",stepperDiv.textContent="",steppers=[]},enabled:!1,active:!1,create:function(pageIndex){var debug=document.createElement("div"),b=(debug.id="stepper"+pageIndex,debug.setAttribute("hidden",!0),debug.className="stepper",stepperDiv.appendChild(debug),document.createElement("option")),b=(b.textContent="Page "+(pageIndex+1),b.value=pageIndex,stepperChooser.appendChild(b),breakPoints[pageIndex]||[]),debug=new Stepper(debug,pageIndex,b);return steppers.push(debug),1===steppers.length&&this.selectStepper(pageIndex,!1),debug},selectStepper:function(pageIndex,selectPanel){for(pageIndex|=0,selectPanel&&this.manager.selectPanel(this),i=0;i<steppers.length;++i){var stepper=steppers[i];stepper.pageIndex===pageIndex?stepper.panel.removeAttribute("hidden"):stepper.panel.setAttribute("hidden",!0)}for(var options=stepperChooser.options,i=0;i<options.length;++i){var option=options[i];option.selected=(0|option.value)===pageIndex}},saveBreakPoints:function(pageIndex,bps){breakPoints[pageIndex]=bps,sessionStorage.setItem("pdfjsBreakPoints",JSON.stringify(breakPoints))}}})(),Stepper=(()=>{function c(tag,textContent){tag=document.createElement(tag);return textContent&&(tag.textContent=textContent),tag}function Stepper(panel,pageIndex,initialBreakPoints){this.panel=panel,this.breakPoint=0,this.nextBreakPoint=null,this.pageIndex=pageIndex,this.breakPoints=initialBreakPoints,this.currentIdx=-1,this.operatorListIdx=0}return Stepper.prototype={init:function(operatorList){var panel=this.panel,content=c("div","c=continue, s=step"),table=c("table"),headerRow=(content.appendChild(table),table.cellSpacing=0,c("tr"));table.appendChild(headerRow),headerRow.appendChild(c("th","Break")),headerRow.appendChild(c("th","Idx")),headerRow.appendChild(c("th","fn")),headerRow.appendChild(c("th","args")),panel.appendChild(content),this.table=table,this.updateOperatorList(operatorList)},updateOperatorList:function(operatorList){var self=this;function cboxOnClick(){var x=+this.dataset.idx;this.checked?self.breakPoints.push(x):self.breakPoints.splice(self.breakPoints.indexOf(x),1),StepperManager.saveBreakPoints(self.pageIndex,self.breakPoints)}if(!(15e3<this.operatorListIdx)){for(var lastCell,chunk=document.createDocumentFragment(),operatorsToDisplay=Math.min(15e3,operatorList.fnArray.length),i=this.operatorListIdx;i<operatorsToDisplay;i++){var line=c("tr"),checked=(line.className="line",line.dataset.idx=i,chunk.appendChild(line),this.breakPoints.includes(i)),args=operatorList.argsArray[i]||[],breakCell=c("td"),cbox=c("input"),checked=(cbox.type="checkbox",cbox.className="points",cbox.checked=checked,cbox.dataset.idx=i,cbox.onclick=cboxOnClick,breakCell.appendChild(cbox),line.appendChild(breakCell),line.appendChild(c("td",i.toString())),opMap[operatorList.fnArray[i]]),cbox=args;if("showText"===checked){for(var glyphs=args[0],newArgs=[],str=[],j=0;j<glyphs.length;j++){var glyph=glyphs[j];"object"==typeof glyph&&null!==glyph?str.push(glyph.fontChar):(0<str.length&&(newArgs.push(str.join("")),str=[]),newArgs.push(glyph))}0<str.length&&newArgs.push(str.join("")),cbox=[newArgs]}line.appendChild(c("td",checked)),line.appendChild(c("td",JSON.stringify(function simplifyArgs(args){if("string"==typeof args)return args.length<=75?args:args.substring(0,75)+"...";if("object"!=typeof args||null===args)return args;if("length"in args){for(var simpleArgs=[],i=0,ii=Math.min(10,args.length);i<ii;i++)simpleArgs.push(simplifyArgs(args[i]));return i<args.length&&simpleArgs.push("..."),simpleArgs}var key,simpleObj={};for(key in args)simpleObj[key]=simplifyArgs(args[key]);return simpleObj}(cbox))))}operatorsToDisplay<operatorList.fnArray.length&&(line=c("tr"),(lastCell=c("td","...")).colspan=4,chunk.appendChild(lastCell)),this.operatorListIdx=operatorList.fnArray.length,this.table.appendChild(chunk)}},getNextBreakPoint:function(){this.breakPoints.sort(function(a,b){return a-b});for(var i=0;i<this.breakPoints.length;i++)if(this.breakPoints[i]>this.currentIdx)return this.breakPoints[i];return null},breakIt:function(idx,callback){StepperManager.selectStepper(this.pageIndex,!0);var self=this,dom=document,listener=(self.currentIdx=idx,function(e){switch(e.keyCode){case 83:dom.removeEventListener("keydown",listener),self.nextBreakPoint=self.currentIdx+1,self.goTo(-1),callback();break;case 67:dom.removeEventListener("keydown",listener);var breakPoint=self.getNextBreakPoint();self.nextBreakPoint=breakPoint,self.goTo(-1),callback()}});dom.addEventListener("keydown",listener),self.goTo(idx)},goTo:function(idx){for(var allRows=this.panel.getElementsByClassName("line"),x=0,xx=allRows.length;x<xx;++x){var row=allRows[x];(0|row.dataset.idx)===idx?(row.style.backgroundColor="rgb(251,250,207)",row.scrollIntoView()):row.style.backgroundColor=null}}},Stepper})(),Stats=(()=>{var stats=[];function clear(node){for(;node.hasChildNodes();)node.removeChild(node.lastChild)}return{id:"Stats",name:"Stats",panel:null,manager:null,init(pdfjsLib){this.panel.setAttribute("style","padding: 5px;")},enabled:!1,active:!1,add(pageNumber,stat){if(stat){var statsIndex=(pageNumber=>{for(var i=0,ii=stats.length;i<ii;++i)if(stats[i].pageNumber===pageNumber)return i;return!1})(pageNumber),b=(!1!==statsIndex&&(b=stats[statsIndex],this.panel.removeChild(b.div),stats.splice(statsIndex,1)),document.createElement("div")),statsIndex=(b.className="stats",document.createElement("div")),statsDiv=(statsIndex.className="title",statsIndex.textContent="Page: "+pageNumber,document.createElement("div"));statsDiv.textContent=stat.toString(),b.appendChild(statsIndex),b.appendChild(statsDiv),stats.push({pageNumber:pageNumber,div:b}),stats.sort(function(a,b){return a.pageNumber-b.pageNumber}),clear(this.panel);for(var i=0,ii=stats.length;i<ii;++i)this.panel.appendChild(stats[i].div)}},cleanup(){stats=[],clear(this.panel)}}})();window.PDFBug=(()=>{var buttons=[],activePanel=null;return{tools:[FontInspector,StepperManager,Stats],enable(ids){var all=!1,tools=this.tools;1===ids.length&&"all"===ids[0]&&(all=!0);for(var i=0;i<tools.length;++i){var tool=tools[i];(all||ids.includes(tool.id))&&(tool.enabled=!0)}all||tools.sort(function(a,b){a=(a=ids.indexOf(a.id))<0?tools.length:a,b=ids.indexOf(b.id);return a-(b<0?tools.length:b)})},init(pdfjsLib,container){for(var ui=document.createElement("div"),controls=(ui.id="PDFBug",document.createElement("div")),panels=(controls.setAttribute("class","controls"),ui.appendChild(controls),document.createElement("div")),tools=(panels.setAttribute("class","panels"),ui.appendChild(panels),container.appendChild(ui),container.style.right="300px",this.tools),self=this,i=0;i<tools.length;++i){var tool=tools[i],panel=document.createElement("div"),panelButton=document.createElement("button");panelButton.textContent=tool.name,panelButton.addEventListener("click",(selected=>function(event){event.preventDefault(),self.selectPanel(selected)})(i)),controls.appendChild(panelButton),panels.appendChild(panel),tool.panel=panel,tool.manager=this,tool.enabled?tool.init(pdfjsLib):panel.textContent=tool.name+' is disabled. To enable add  "'+tool.id+'" to the pdfBug parameter and refresh (separate multiple by commas).',buttons.push(panelButton)}this.selectPanel(0)},cleanup(){for(var i=0,ii=this.tools.length;i<ii;i++)this.tools[i].enabled&&this.tools[i].cleanup()},selectPanel(index){if((index="number"!=typeof index?this.tools.indexOf(index):index)!==activePanel){activePanel=index;for(var tools=this.tools,j=0;j<tools.length;++j)j===index?(buttons[j].setAttribute("class","active"),tools[j].active=!0,tools[j].panel.removeAttribute("hidden")):(buttons[j].setAttribute("class",""),tools[j].active=!1,tools[j].panel.setAttribute("hidden","true"))}}}})();